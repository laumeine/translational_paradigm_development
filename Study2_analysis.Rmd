---
title: "Analyses for 'A Translational Paradigm to Study the Effects of Uncontrollable Stress in Humans'"
subtitle: "Study 2 Analysis"
author: "Laura E. Meine (based on earlier code written by Laura E. Meine and Katja Schueler)"
date: "18.08.2020"
output:
   html_document:
    theme: flatly
    toc: yes
    toc_float: yes
    number_sections: true
---

```{r setup, include=FALSE}
knitr:: opts_chunk$set(cache = TRUE, echo = FALSE, warning = FALSE, message = FALSE, fig.align="center")
```
# Summary

This script runs analyses on data from study 2. Specifically, it compares data from two groups of participants who underwent escapable stress (EC) or yoked inescapable stress (YC), respectively. We use the terms "group" and "condition" interchangeably. . Measurements under investigation comprised reaction times (RTs) and ratings under acute stress (stressor aversiveness, control, exhaustion, helplessness) as well as pre-post changes in affective state (STADI and PANAS questionnaires), and effects escape behaviour (activity, exploration, escapes, efficiency).

```{r load libraries}
library(tidyverse) 
library(afex) 
library(ggpubr) # for easy plotting
library(rstatix) 
library(Rmisc) 
library(lsmeans) 
library(effsize)
library(WRS2) # for robust ANOVA
```

```{r create ggplot theme}
# set standard ggplot theme
laura_theme <- theme(panel.border = element_rect(colour="black", fill="transparent", size=1),
                     panel.background = element_rect(fill="transparent"),
                     axis.line = element_line(colour="black"),
                     panel.grid.minor = element_line(colour="transparent"),
                     axis.title.x = element_text(size=30, vjust=-.25),
                     axis.title.y = element_text(size=30, vjust=1),
                     axis.text.x = element_text(size=24, colour="black"),
                     axis.text.y = element_text(size=24, colour="black"),
                     strip.text.x = element_text(size = 20),
                     legend.text=element_text(size=14),
                     legend.title = element_text(size = 16))

# define 2 theme colours to use (colorblind-friendly, s. http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/)
colour1 = "#009E73" 
colour2 = "#D55E00" 
```

```{r import data}
# read in study 2 data
demo <- read.csv("study2_data/study2_demographics.csv", header=T)
stress <- read.csv("study2_data/study2_stress_induction.csv", sep=";", header=T)
affStates <- read.csv("study2_data/study2_affect_states.csv", sep=";", header=T)
escapeBehav <- read.csv("study2_data/study2_escape_behaviour.csv", sep=";", header=T)
```

# Sample Descriptives

```{r sample descriptives}
# define variables to shorten code
EC <- demo$condition=="EC"
YC <- demo$condition=="YC"

# function for plotting
stat_sum_single <- function(fun, geom="point", ...) {
  stat_summary(fun.y=fun, shape = 23, fill = "white", geom = geom, size = 3, ...)} #summarise y values

# sample sizes
N <- nrow(demo) # 100
n <- table(demo$condition) # 62 EC, 38 YC
```
In total, the sample consisted of *N* = `r N` participants with *n* = `r n[1]` in EC and *n* = `r n[2]` in YC. 

## Age & Sex
```{r plot age by sex}
demo$sex <- ifelse(demo$sex==2, "m", "f") # rename sex variable levels for more intuitive results
demo$sex <- as.factor(demo$sex)

# percent female
ec.f <- (table(demo$sex[EC])[1]/nrow(demo[EC,]))*100
yc.f <- (table(demo$sex[YC])[1]/nrow(demo[YC,]))*100

# age by condition
age_descr <- summarySE(demo, measurevar="age", groupvars="condition", conf.interval=.95) 

# plot age distribution by sex
ageHist <- ggplot(demo, aes(x = trunc(age), fill = sex)) +
  geom_histogram(colour = "white", bins = 14) +
  scale_fill_manual(values = c(colour1, colour2), name="Sex") +
  xlab("Age") +
  laura_theme
ageHist
```

# A priori Group Difference Checks

## Sex (Chi-square Test)
```{r check sex}
# run chi-square test
chisqSex <- chisq.test(demo$condition, demo$sex)
chisqSex
```
There were no a priori group differences in male-female ratio.

## Age (t-test)
```{r check age - prep, include = FALSE}
# check for outliers by group
ageOutlier <- ggplot(demo, aes(condition, age, fill=condition)) + 
    geom_violin() +
    geom_boxplot(width=0.2) +
    stat_sum_single(mean) +
    xlab("Experimental Condition") +
    ylab("Age") +
    scale_fill_manual(values=c(colour1, colour2)) +
    laura_theme
ageOutlier # some outliers

# get outlier IDs
ageOutlierIDs <- demo %>%
  group_by(condition) %>%
  identify_outliers(age)

# output extreme outliers
#unique(ageOutlierIDs$ID[ageOutlierIDs$is.extreme==T]) # 2 38-year-olds (EC06, EC25)
```
```{r check age - t-test}
# run t.test for independent samples to check for significant differences in age
t.test(demo$age[demo$condition=="EC"], demo$age[demo$condition=="YC"], paired=F, var.equal=T) 

# trend effect

# get cohen's d
cohen.d(demo$age[demo$condition=="EC"], demo$age[demo$condition=="YC"])
```
Overall, there were no significant differences in age across groups (only a trend effect).There were two extreme outliers which we excluded from subsequent analyses.

## Level of Education
```{r check education}
# level of education: 1 = , 2 = ..., 6 = Fachhochschulreife, 7 = Abitur, 8 = , 9 = , 10 = Bachelor, 11 = Master/Staatsexamen/Diplom, 12 = PhD - get missing info!

# get reported levels
educationLevels <- levels(as.factor(demo$education_level)) # 6,7,10,11

# education by condition
edu_descr <- summarySE(demo, measurevar="education_level", groupvars="condition", conf.interval=.95) 

eduOutlier <- ggplot(demo, aes(condition, education_level, fill=condition)) + 
    geom_boxplot(width=0.2) +
    geom_point(position = position_jitter(w = 0.3, h = 0)) +  
    stat_sum_single(mean) +
    scale_y_continuous(breaks=c(1:12), limits=c(1,12)) +
    xlab("Experimental Condition") +
    ylab("Level of Education") +
    scale_fill_manual(values=c(colour1, colour2)) +
    laura_theme
eduOutlier # some outliers

# Wilcoxon rank sum test
edu.test <- demo %>% 
  wilcox_test(education_level ~ condition) %>%
  add_significance()
edu.test

# no group differences

# get wilcoxon's r as measure of effect size
demo %>% wilcox_effsize(education_level ~ condition)
```
There were no a priori group differences with respect to level of education. 

```{r add demopgraphic variables to data}
# exclude age outliers
demo <- demo[! (demo$ID=="EC06" | demo$ID=="EC25"), ]

# add demographic variables to other data frames 
stress <- join(demo, stress)
affStates <- join(demo, affStates)
escapeBehav <- join(demo, escapeBehav)
```

# Manipulation Check

## Verify Yoking of Stress Durations
```{r yoking check}
# plot stress_duration by trial and condition
stressDurPlot <- ggplot(stress, aes(trial, stress_duration, fill=condition)) +
  geom_bar(stat = "summary", position="dodge", fun.y="mean") + 
  scale_x_continuous(breaks=seq(1,60,1)) +
  ylim(0,15) + # max. possible duration was 10s
  ylab("Stress Duration (s)") +
  xlab("Trial") +
  laura_theme + theme(axis.text.x = element_text(size = 6)) +
  scale_fill_manual(values=c(colour1, colour2))
stressDurPlot

# run t-test for independent samples
t.test(stress$stress_duration[stress$condition=="EC"], stress$stress_duration[stress$condition=="YC"], paired=F, var.equal=T) # n.s.
```
There were no overall differences in overall stress durations between EC and YC because YC participants were pseudoyoked to EC. Very slight timing inaccurracies are due to program execution differences. Note that durations across trials differ between groups. We deliberately introduced a discount of max. stress exposure in EC to enhance the feeling of control. In YC, we randomly shuffled stress durations obtained from EC to enhance the feeling of arbitrary stress durations outside the participant's control.

## Assess Performance in EC
```{r check EC performance}
# correct performance by condition
correct_group_descr <- summarySE(stress, measurevar="correct", groupvars="condition", conf.interval=.95, na.rm=T) 

# correct performance by ID
correct_ID_descr <- summarySE(stress, measurevar="correct", groupvars="ID", conf.interval=.95, na.rm=T) 

# we should maybe exclude EC participants that have less than a third correct because they would obviously have experienced little control which would void our manipulation (cf. Hartley et al., 2014)

correct_ID_descr <- merge(correct_ID_descr, demo[, c(1,2)], by=("ID"), all=T) # add condition again

# get EC ID's with low performance
nECLowCorrect <- length(correct_ID_descr$ID[correct_ID_descr$condition=="EC" & correct_ID_descr$correct<.30])
ECremain <- n[1]-nECLowCorrect

#54 ECs remain

# exclude ECLowCorrect participants to assess whether results in subsequent analyses change
#stress <- stress[! (stress$ID=="EC16" | stress$ID=="EC18" | stress$ID=="EC24" |
#                     stress$ID=="EC46" | stress$ID=="EC51" | stress$ID=="EC80" |
#                     stress$ID=="EC82" | stress$ID=="EC84"), ]

ECcorrect.m <- mean(stress$correct[stress$condition=="EC"], na.rm=T)
ECcorrect.sd <- sd(stress$correct[stress$condition=="EC"], na.rm=T)
```
`r nECLowCorrect` EC participants had less than 30% correct trials, however, excluding them did not affect subsequent results, so we kept them.

```{r prepare rating data}
# extract rating rows (every 15th trial = 4 ratings per ID)
ratings <- stress[seq(0, nrow(stress), 15), ]

# calculate mean ratings by ID
ratingMean <- ratings %>%   group_by(ID) %>%  summarise_all(funs(mean(., na.rm = TRUE)))
ratingMean <- ratingMean[, -c(2,3,5,6,9,10,12)] # delete unnecessary columns
ratingMean <- join(ratingMean, demo[, c(1:3)]) # add condition and sex again
```

## Stressor Aversiveness
```{r manipulation check - stressor aversiveness ratings, plot to identify outliers}
# exclude cases with missing responses (1 YC)
#unique(ratings$ID[is.na(ratings$aversive_rating)]) # CSE02
ratings_avers <- ratings[ratings$ID!="CSE02", ]
ratingMean_avers <- ratingMean[ratingMean$ID!="CSE02", ]

# verify that stressor was rated as aversive in EC and YC
avers.m <- mean(ratingMean_avers$aversive_rating) # global mean rating

# boxplot by group and trial
aversBoxPlot <- ggplot(ratings_avers, aes(factor(trial), aversive_rating, fill=condition)) + 
  geom_violin() +  
  geom_boxplot(width=0.2, position=position_dodge(1)) +
    ylab("Stressor Aversiveness") +
    xlab("Trial") +
    scale_fill_manual(values=c(colour1, colour2)) +
    laura_theme
aversBoxPlot # some outliers

# check for outliers by group and trial (this is more sensitive because e.g. shock electrode may not have transmitted properly in some trials)
aversOutlierIDs <- ratings_avers %>%
  group_by(condition, trial) %>%
  identify_outliers(aversive_rating) # 4 outliers

# output extreme outliers
#unique(aversOutlierIDs$ID[aversOutlierIDs$is.extreme==T]) # none
```
There were no extreme outliers with respect to aversiveness ratings.

```{r manipulation check - stressor aversiveness ratings}
# aversiveness ratings by condition
avers_group_descr <- summarySE(ratingMean_avers, measurevar="aversive_rating", groupvars="condition", conf.interval=.95) 

# aversiveness ratings by condition and trial
avers_trial_descr <- summarySEwithin(ratings_avers, measurevar="aversive_rating", betweenvars="condition", withinvars="trial", idvar="ID", conf.interval=.95) 

# plot ratings across trials by group
aversPlot <- ggplot(avers_trial_descr, aes(as.numeric(as.character(trial)), aversive_rating, colour=condition)) +
  geom_line(size=1) +
  geom_errorbar(aes(ymin=aversive_rating-se, ymax=aversive_rating+se), width=.1) +
  scale_y_continuous(breaks=c(1:7), limits=c(0.9,7.1)) + # max. possible rating was 7
  ylab("Stressor Aversiveness") +
  xlab("Trial") +
  scale_color_manual(values=c(colour1, colour2))  +
  laura_theme
aversPlot

# test whether groups differed in stressor aversiveness and whether ratings changed over time
# rmANOVA with condition and trial

# check normality assumption
aversqqplot <- ggqqplot(ratings_avers, "aversive_rating", ggtheme = theme_bw()) +
  facet_grid(trial ~ condition, labeller = "label_both") # looks acceptable
#aversqqplot

# run rmANOVA
avers.fit <- aov_ez("ID","aversive_rating", ratings_avers, between="condition", within="trial") #sphericity is automatically checked and corrected if needed
summary(avers.fit) 
nice(avers.fit, es="pes")

# no main effect of group, EC and YC both rate stress as very aversive
# trend effect of trial

# run rmANOVA including sex
avers.fit <- aov_ez("ID","aversive_rating", ratings_avers, between=c("condition", "sex"), within="trial")
summary(avers.fit) 
nice(avers.fit, es="pes")

# sig. interaction of condition x sex x trial

# plot stressor aversiveness split by sex and trial
avers.fitSexPlot <- ggboxplot(
  ratings_avers, x = "trial", y = "aversive_rating",
  color = "sex", palette = "cbPalette",
  facet.by = "condition", short.panel.labs = FALSE)
avers.fitSexPlot
```
Both EC and YC rated the stressor as very aversive (global *M* = `r avers.m`). Mean aversiveness ratings did not differ between groups. Stressor aversiveness ratings remained constant over time (there was only a trend for change over trials). We observed a group x sex x trial interaction.

## Perceived Stressor Controllability
```{r manipulation check - controllability ratings, plot to identify outliers}
# boxplot by group and trial
ctrlBoxPlot <- ggplot(ratings, aes(factor(trial), control_rating, fill=condition)) + 
  geom_violin() +  
  geom_boxplot(width=0.2, position=position_dodge(1)) +
    ylab("Perceived Control") +
    xlab("Trial") +
    scale_fill_manual(values=c(colour1, colour2)) +
    laura_theme
ctrlBoxPlot # some outliers

# get outlier IDs
ctrlOutlierIDs <- ratings %>%
  group_by(condition, trial) %>%
  identify_outliers(control_rating)

# output extreme outliers
#unique(ctrlOutlierIDs$ID[ctrlOutlierIDs$is.extreme==T]) # none
```
There were no extreme outliers with respect to perceived control ratings.

```{r manipulation check - controllability ratings}
# controllability ratings by condition
ctrl_group_descr <- summarySE(ratingMean, measurevar="control_rating", groupvars="condition", conf.interval=.95) 

# controllability ratings by condition and trial
ctrl_trial_descr <- summarySEwithin(ratings, measurevar="control_rating", betweenvars="condition", withinvars="trial", idvar="ID", conf.interval=.95) 

# plot ratings across trials by group
ctrlPlot <- ggplot(ctrl_trial_descr, aes(as.numeric(as.character(trial)), control_rating, colour=condition)) +
  geom_line(size=1) +
  geom_errorbar(aes(ymin=control_rating-se, ymax=control_rating+se), width=.1) +
  scale_y_continuous(breaks=c(1:7), limits=c(0.9,7.1)) +
  ylab("Perceived Control") +
  xlab("Trial") +
  scale_color_manual(values=c(colour1, colour2))  +
  laura_theme
ctrlPlot

# rmANOVA with condition and trial

# check normality assumption
ctrlqqplot <- ggqqplot(ratings, "control_rating", ggtheme = theme_bw()) +
  facet_grid(trial ~ condition, labeller = "label_both") # looks ok
#ctrlqqplot

# run rmANOVA
ctrl.fit <- aov_ez("ID","control_rating", ratings, between="condition", within="trial")
summary(ctrl.fit)
nice(ctrl.fit, es="pes")

# main effect of condition --> EC rates higher control
# main effect of trial

# post-hoc comparisons - trial
ref1 <- lsmeans(ctrl.fit, specs = "trial")
pwc <- contrast(ref1, method="pairwise", adjust="holm")
pwc

# perceived control increased, especially towards the end of the experiment

# confirm results with robust ANOVA
ctrl.fitrobust <- bwtrim(control_rating ~ condition*factor(trial), ID, data = ratings) 
ctrl.fitrobust

# run rmANOVA including sex
ctrl.fit <- aov_ez("ID","control_rating", ratings, between=c("condition", "sex"), within="trial")
summary(ctrl.fit)
nice(ctrl.fit, es="pes")

# no sig. sex effect
```
We observed group differences in perceived control in the expected direction: YC reported lower control than EC. Overall perceived control increased over time (not clear why this would be the case in YC). No sex differences emerged.

```{r exploratory analysis to investigate individual differences in EC, include = FALSE}
# correlation to test whether performance and perceived control are related
ECctrlCorr <- join(ratingMean[ratingMean$condition=="EC", ], correct_ID_descr)
cor.test(ECctrlCorr$control_rating, ECctrlCorr$correct)
plot(ECctrlCorr$correct, ECctrlCorr$control_rating)

# with higher rates of correct performance come higher ratings of controllability - this was to be expected
```

# Ratings and RT During Stress Exposure

## Feelings of Helplessness
```{r helplessness ratings, plot to identify outliers}
# boxplot by group and trial
helpBoxPlot <- ggplot(ratings, aes(factor(trial), helpless_rating, fill=condition)) + 
  geom_violin() +  
  geom_boxplot(width=0.2, position=position_dodge(1)) +
    ylab("Helplessness") +
    xlab("Trial") +
    scale_fill_manual(values=c(colour1, colour2)) +
    laura_theme
helpBoxPlot # no outliers
```
There were no outliers with respect to helplessness ratings.

```{r helplessness ratings}
# t.test for group differences
t.test(ratingMean$helpless_rating[ratingMean$condition=="EC"], ratingMean$helpless_rating[ratingMean$condition=="YC"], paired=F, var.equal=T)
# sig. group differences --> YC reports more helplessness

# get cohen's d
cohen.d(ratingMean$helpless_rating[ratingMean$condition=="EC"], ratingMean$helpless_rating[ratingMean$condition=="YC"])
# medium effect

# helplessness ratings by condition
help_group_descr <- summarySE(ratingMean, measurevar="helpless_rating", groupvars="condition", conf.interval=.95) 

# helplessness ratings by condition and trial
help_trial_descr <- summarySEwithin(ratings, measurevar="helpless_rating", betweenvars="condition", withinvars="trial", idvar="ID", conf.interval=.95) 

# plot ratings across trials by group
helpPlot <- ggplot(help_trial_descr, aes(as.numeric(as.character(trial)), helpless_rating, colour=condition)) +
  geom_line(size=1) +
  geom_errorbar(aes(ymin=helpless_rating-se, ymax=helpless_rating+se), width=.1) +
  scale_y_continuous(breaks=c(1:7), limits=c(0.9,7.1)) +
  ylab("Helplessness") +
  xlab("Trial") +
  scale_color_manual(values=c(colour1, colour2))  +
  laura_theme
helpPlot

# rmANOVA with condition and trial and sex

# check normality assumption
helpqqplot <- ggqqplot(ratings, "helpless_rating", ggtheme = theme_bw()) +
  facet_grid(trial ~ condition, labeller = "label_both") # looks ok
#helpqqplot

# run rmANOVA
help.fit <- aov_ez("ID","helpless_rating", ratings, between=c("condition", "sex"), within="trial")
summary(help.fit)
nice(help.fit, es="pes")

# main effect of trial
# no sex effect

# post-hoc comparisons - trial
ref1 <- lsmeans(help.fit, specs = "trial")
pwc <- contrast(ref1, method="pairwise", adjust="holm")
pwc

# helplessness ratings decreased over time

# confirm results with robust ANOVA
help.fitrobust <- bwtrim(helpless_rating ~ condition*factor(trial), ID, data = ratings) # how to include sex as covariate?
help.fitrobust
```
As expected, YC reported greater feelings of helplessness compared to EC. Overall helplessness ratings decreased across trials.

## Exhaustion
```{r exhaustion ratings, plot to identify outliers}
# boxplot by group and trial
exhstBoxPlot <- ggplot(ratings, aes(factor(trial), exhausted_rating, fill=condition)) + 
  geom_violin() +  
  geom_boxplot(width=0.2, position=position_dodge(1)) +
    ylab("Exhaustion") +
    xlab("Trial") +
    scale_fill_manual(values=c(colour1, colour2)) +
    laura_theme
exhstBoxPlot # no outliers
```
There were no outliers with respect to exhaustion ratings.

```{r exhaustion ratings}
# t.test for group differences
t.test(ratingMean$exhausted_rating[ratingMean$condition=="EC"], ratingMean$exhausted_rating[ratingMean$condition=="YC"], paired=F, var.equal=T)
# no sig. group differences

# get cohen's d
cohen.d(ratingMean$exhausted_rating[ratingMean$condition=="EC"], ratingMean$exhausted_rating[ratingMean$condition=="YC"])

# exhaustion ratings by condition
exhst_group_descr <- summarySE(ratingMean, measurevar="exhausted_rating", groupvars="condition", conf.interval=.95, na.rm=T) 

# exhaustion ratings by condition and trial
exhst_trial_descr <- summarySEwithin(ratings, measurevar="exhausted_rating", betweenvars="condition", withinvars="trial", idvar="ID", conf.interval=.95) 

# plot ratings across trials by group
exhstPlot <- ggplot(exhst_trial_descr, aes(as.numeric(as.character(trial)), exhausted_rating, colour=condition)) +
  geom_line(size=1) +
  geom_errorbar(aes(ymin=exhausted_rating-se, ymax=exhausted_rating+se), width=.1) +
  scale_y_continuous(breaks=c(1:7), limits=c(0.9,7.1)) +
  ylab("Exhaustion") +
  xlab("Trial") +
  scale_color_manual(values=c(colour1, colour2))  +
  laura_theme
exhstPlot

# rmANOVA with condition and trial and sex

# check normality assumption
exhstqqplot <- ggqqplot(ratings, "exhausted_rating", ggtheme = theme_bw()) +
  facet_grid(trial ~ condition, labeller = "label_both") # looks ok
#exhstqqplot

# run rmANOVA
exhst.fit <- aov_ez("ID","exhausted_rating", ratings, between=c("condition", "sex"), within="trial")
summary(exhst.fit)
nice(exhst.fit, es="pes")

# main effect of trial, sex effect

# post-hoc comparisons - trial
ref1 <- lsmeans(exhst.fit, specs = "trial")
pwc <- contrast(ref1, method="pairwise", adjust="holm")
pwc

# exhaustion increased and decreased across trials 

# confirm results with robust ANOVA
exhst.fitrobust <- bwtrim(exhausted_rating ~ condition*factor(trial), ID, data = ratings) 
exhst.fitrobust

# get mean exhaustion ratings for male and female participants
#mean(ratings$exhausted_rating[ratings$sex=="f"]) # 5.078
#mean(ratings$exhausted_rating[ratings$sex=="m"]) # 4.1

# men reported less exhaution
```
There were no group differences in terms of exhaustion ratings. Overall reported exhaustion increased, then decreased over time. Men reported less exhaustion compared to women.

## RTs
```{r prepare RT data}
# convert to ms
stress$rt <- stress$rt*1000

# calculate mean RT by ID
RTMean <- aggregate(rt ~ ID, stress, FUN=mean)
RTMean <- join(RTMean, demo[, c(1:3)]) # add condition and sex again
```
```{r RTs, plot distribution to identify outliers}
# check for outliers by group
RTOutlier <- ggplot(RTMean, aes(condition, rt, fill=condition)) + 
    geom_violin() +
    geom_boxplot(width=0.2) +
    stat_sum_single(mean) +
    xlab("Experimental Condition") +
    ylab("Mean RT") +
    scale_fill_manual(values=c(colour1, colour2)) +
    laura_theme
RTOutlier # 3 outliers

# get outlier IDs
RTOutlierIDs <- RTMean %>%
  group_by(condition) %>%
  identify_outliers(rt)

# output extreme outliers
#unique(RTOutlierIDs$ID[RTOutlierIDs$is.extreme==T]) # none
```
There were no extreme outliers with respect to RT.

```{r RTs}
# t.test for group differences
t.test(RTMean$rt[RTMean$condition=="EC"], RTMean$rt[RTMean$condition=="YC"], paired=F, var.equal=T)
# sig. group differences

# get cohen's d
cohen.d(RTMean$rt[RTMean$condition=="EC"], RTMean$rt[RTMean$condition=="YC"])
# large effect

# RTs by condition
RT_group_descr <- summarySE(RTMean, measurevar="rt", groupvars="condition", conf.interval=.95, na.rm=T) 

# RTs by condition and trial
RT_trial_descr <- summarySEwithin(stress, measurevar="rt", betweenvars="condition", withinvars="trial", idvar="ID", conf.interval=.95, na.rm=T) 

# plot RT across trials by group
RTPlot <- ggplot(RT_trial_descr, aes(as.numeric(as.character(trial)), rt, colour=condition)) +
  geom_line(size=1) +
  geom_errorbar(aes(ymin=rt-se, ymax=rt+se), width=.1) +
  ylab("RT (ms)") +
  xlab("Trial") +
  scale_color_manual(values=c(colour1, colour2))  +
  laura_theme
RTPlot

# rmANOVA with condition and trial and sex

# check normality assumption
#stress_rt %>%
#  group_by(condition, trial) %>%
#  shapiro_test(rt) 

# robust ANOVA
rt.fitrobust <- bwtrim(rt ~ condition*trial, ID, data = stress) # how to include sex as covariate?
rt.fitrobust

# EC was sig. faster than YC

# get effect sizes
akp.effect(rt ~ condition, data = stress)
akp.effect(rt ~ trial, data = stress)

# t.test for sex differences
t.test(RTMean$rt[RTMean$sex=="f"], RTMean$rt[RTMean$sex=="m"], paired=F, var.equal=T)
# no sig. group differences
```
EC was significantly faster than YC. There was no effect of trial.

# Changes in Affective State

## Depression and Anxiety (STADI)
```{r depression and anxiety - STADI, plot to identify outliers}
# reorder factor levels for plotting
affStates$time <- factor(affStates$time, levels = c("pre", "post"))

# plot scores by group and time
STADIPlot <- ggplot(affStates, aes(time, STADI_S_Global, fill=condition)) + 
    geom_violin() +  
    geom_boxplot(width=0.2, position=position_dodge(1)) +
    xlab("Time") +
    ylab("Depression and Anxiety") +
    scale_fill_manual(values=c(colour1, colour2)) +
    laura_theme
STADIPlot # some outliers

# get outlier IDs
STADIOutlierIDs <- affStates %>%
  group_by(condition, time) %>%
  identify_outliers(STADI_S_Global)

# output extreme outliers
#unique(STADIOutlierIDs$ID[STADIOutlierIDs$is.extreme==T]) # none
```
There were no extreme outliers with respect to STADI scores.

```{r depression and anxiety - STADI}
# STADI by condition
STADI_group_descr <- summarySE(affStates, measurevar="STADI_S_Global", groupvars="condition", conf.interval=.95) 

# STADI by condition and time
STADI_time_descr <- summarySEwithin(affStates, measurevar="STADI_S_Global", betweenvars="condition", withinvars="time", idvar="ID", conf.interval=.95) 

# rmANOVA with condition and time

# check normality assumption
STADIqqplot <- ggqqplot(affStates, "STADI_S_Global", ggtheme = theme_bw()) +
  facet_grid(time ~ condition, labeller = "label_both") # looks ok but could be better
#STADIqqplot

# run rmANOVA
STADI.fit <- aov_ez("ID","STADI_S_Global", affStates, between="condition", within="time")
summary(STADI.fit)
nice(STADI.fit, es="pes")

# trend for a group effect
# main effect of time --> pre to post increase in depressive symptoms and anxiety
# no interaction of group x time

# confirm results with robust ANOVA
STADI.fitrobust <- bwtrim(STADI_S_Global ~ condition*factor(time), ID, data = affStates) # how to include sex as covariate?
STADI.fitrobust

# rmANOVA with condition and time and sex 

# run rmANOVA
STADISex.fit <- aov_ez("ID","STADI_S_Global", affStates, between=c("condition", "sex"), within="time")
summary(STADISex.fit)
nice(STADISex.fit, es="pes")

# no sex effect
```
There was a trend effect of group with YC showing slightly higher scores than EC at pre and post. Although both groups reported an sig. increase in depressive symptoms and anxiety from pre to post stress induction, there was no interaction effect, i.e. no differential changes in STADI scores.

## Negative and Positive Mood (PANAS)

### Negative Mood
```{r negative mood - PANASneg, plot to identify outliers}
# plot scores by group and time
PANASnegPlot <- ggplot(affStates, aes(time, PANAS_neg, fill=condition)) + 
    geom_violin() +  
    geom_boxplot(width=0.2, position=position_dodge(1)) +
    xlab("Time") +
    ylab("Negative Mood") +
    scale_fill_manual(values=c(colour1, colour2)) +
    laura_theme
PANASnegPlot # some outliers

# get outlier IDs
PANASnegOutlierIDs <- affStates %>%
  group_by(condition, time) %>%
  identify_outliers(PANAS_neg) 

# output extreme outliers
#unique(PANASnegOutlierIDs$ID[PANASnegOutlierIDs$is.extreme==T]) 

# exclude extreme outlier
affStates_PANASneg <- affStates[affStates$ID!="EC53", ]
```
There was one extreme outlier with respect to negative mood which we excluded from this analysis.

```{r negative mood - PANASneg}
# PANASneg by condition
PANASneg_group_descr <- summarySE(affStates_PANASneg, measurevar="PANAS_neg", groupvars="condition", conf.interval=.95) 

# PANASneg by condition and time
PANASneg_time_descr <- summarySEwithin(affStates_PANASneg, measurevar="PANAS_neg", betweenvars="condition", withinvars="time", idvar="ID", conf.interval=.95) 

# rmANOVA with condition and time

# check normality assumption
PANASnegqqplot <- ggqqplot(affStates, "PANAS_neg", ggtheme = theme_bw()) +
  facet_grid(time ~ condition, labeller = "label_both") # bit crooked
#PANASnegqqplot

# run rmANOVA
PANASneg.fit <- aov_ez("ID","PANAS_neg", affStates, between="condition", within="time")
summary(PANASneg.fit)
nice(PANASneg.fit, es="pes")

# main effect of condition (YC shows slightly higher overall neg. mood )
# main effect of time shows increase in neg. mood
# no interaction of condition x time

# confirm results with robust ANOVA
PANASneg.fitrobust <- bwtrim(PANAS_neg ~ condition*factor(time), ID, data = affStates)
PANASneg.fitrobust

# rmANOVA with condition and time and sex
PANASnegSex.fit <- aov_ez("ID","PANAS_neg", affStates_PANASneg, between=c("condition", "sex"), within="time", covariate="sex")
summary(PANASnegSex.fit)
nice(PANASnegSex.fit, es="pes")

# sig. interaction of group x sex x time

# plot PANAS_neg split by group, time, and sex
PANASneg.fitSexPlot <- ggboxplot(
  affStates_PANASneg, x = "time", y = "PANAS_neg",
  color = "sex", palette = "cbPalette",
  facet.by = "condition", short.panel.labs = FALSE)
PANASneg.fitSexPlot
```
There were sig. group differences in negative mood with slightly higher overall scores in YC compared to EC. We observed an overall decrease from pre to post stress induction but no interaction of group x time. However, a significant interaction of group x sex x time emerged.

### Positive Mood
```{r positive mood - PANASpos, plot to identify outliers}
# plot scores by group and time
PANASposPlot <- ggplot(affStates, aes(time, PANAS_pos, fill=condition)) + 
    geom_violin() +  
    geom_boxplot(width=0.2, position=position_dodge(1)) +
    xlab("Time") +
    ylab("Positive Mood") +
    scale_fill_manual(values=c(colour1, colour2)) +
    laura_theme
PANASposPlot # no outlier
```
There were no outliers with respect to positive mood scores.

```{r positive mood - PANASpos}
# PANASpos by condition
PANASpos_group_descr <- summarySE(affStates, measurevar="PANAS_pos", groupvars="condition", conf.interval=.95) 

# PANASpos by condition and time
PANASpos_time_descr <- summarySEwithin(affStates, measurevar="PANAS_pos", betweenvars="condition", withinvars="time", idvar="ID", conf.interval=.95) 

# rmANOVA with condition and time

# check normality assumption
PANASposqqplot <- ggqqplot(affStates, "PANAS_pos", ggtheme = theme_bw()) +
  facet_grid(time ~ condition, labeller = "label_both") # looks ok
#PANASposqqplot

# run rmANOVA
PANASpos.fit <- aov_ez("ID","PANAS_pos", affStates, between="condition", within="time")
summary(PANASpos.fit)
nice(PANASpos.fit, es="pes")

# main effect of time with decreased positive mood post stress exposure across groups
# no interaction of condition x time

# run rmANOVA including sex
PANASposSex.fit <- aov_ez("ID","PANAS_pos", affStates, between=c("condition", "sex"), within="time")
summary(PANASposSex.fit)
nice(PANASposSex.fit, es="pes")

# interaction of sex x time

# plot scores split for sex
PANASpos.fitSexPlot <- ggboxplot(
  affStates, x = "time", y = "PANAS_pos",
  color = "sex", palette = "cbPalette", short.panel.labs = FALSE)
PANASpos.fitSexPlot

# men show less decrease in pos. mood from pre to post
```
There were no group differences in positive mood but an overall decrease from pre to post stress induction. Men displayed a slightly smaller decrease compared to women.

# Escape Behaviour

## Activity (moves per minute)
```{r activity - escape behaviour test, plot to identify outliers}
# boxplot by group, phase, and block
activityBoxPlot <- ggplot(escapeBehav, aes(factor(phase), mpm, fill=condition)) + 
    geom_violin() +  
    geom_boxplot(width=0.2, position=position_dodge(1)) +
    ylab("Activity (moves/minute)") +
    xlab("Phase") +
    scale_fill_manual(values=c(colour1, colour2)) +
    laura_theme
activityBoxPlot # some outliers

# get outlier IDs
activityOutlierIDs <- escapeBehav %>%
  group_by(condition, phase, block) %>%
  identify_outliers(mpm) 

# output extreme outliers
#unique(activityOutlierIDs$ID[activityOutlierIDs$is.extreme==T])

# exclude extreme outliers
escapeBehav_activity <- escapeBehav[! (escapeBehav$ID=="EC71" | escapeBehav$ID=="EC87"), ]
```
There were two extreme outliers with respect to activity and we excluded them from this analysis.

```{r activity - escape behaviour test}
# Activity by condition
activity_group_descr <- summarySE(escapeBehav, measurevar="mpm", groupvars="condition", conf.interval=.95) 

# Activity by condition and phase
activity_phase_descr <- summarySEwithin(escapeBehav, measurevar="mpm", betweenvars="condition", withinvars="phase", idvar="ID", conf.interval=.95) 

# Activity by condition, phase, and block
activity_phase_block_descr <- summarySEwithin(escapeBehav, measurevar="mpm", betweenvars="condition", withinvars=c("phase", "block"), idvar="ID", conf.interval=.95) 

# rmANOVA with condition, phase, and block

# check normality assumption
activityqqplot <- ggqqplot(escapeBehav, "mpm", ggtheme = theme_bw()) +
  facet_grid(phase ~ condition, labeller = "label_both") # bit crooked
#activityqqplot 

# run rmANOVA
activity.fit <- aov_ez("ID","mpm", escapeBehav, between="condition", within=c("phase", "block"))
summary(activity.fit)
nice(activity.fit, es="pes")

# main effect of phase --> more activity in stress phase
# main effect of block --> more activity in block 2

#activity.fitrobust <- bwtrim(mpm ~ condition*factor(phase), ID, data = escapeBehav) # bwtrim can only handle one within-subject factor at a time
#activity.fitrobust

# run rmANOVA including sex
activitySex.fit <- aov_ez("ID","mpm", escapeBehav, between=c("condition", "sex"), within=c("phase", "block"))
summary(activitySex.fit)
nice(activitySex.fit, es="pes")

# sex effect --> men show more activity

# plot by group, phase, and block
activityPlotBlock <- ggplot(escapeBehav, aes(factor(block), mpm, fill=factor(phase))) +
  geom_violin() +  
  geom_boxplot(width=0.2, position=position_dodge(1)) +
  ylab("Activity") +
  xlab("Block") +
  facet_grid(~factor(condition)) +
  scale_fill_manual(values=c("cornflowerblue", "indianred2"))  +
  laura_theme
activityPlotBlock
```
There was no main effect of group but a significant difference in activity between the free exploration phase and the stress phase as well as between blocks. Participants showed increased activity over blocks and generally lower activity in the stress phase. Men showed more activity compared to women.

## Exploration 
```{r exploration - escape behaviour test, plot to identify outlier}
# exploration is most interesting in no stress phase!
explorationNoStress <- escapeBehav[escapeBehav$phase!="stress", ]

# boxplot by group, phase, and block
explorationBoxPlot <- ggplot(escapeBehav, aes(factor(phase), exploration, fill=condition)) + 
    geom_violin() +  
    geom_boxplot(width=0.2, position=position_dodge(1)) +
    ylab("Exploration (unique places visited/minute)") +
    xlab("Phase") +
    scale_fill_manual(values=c(colour1, colour2)) +
    laura_theme
explorationBoxPlot # some outliers

# get outlier IDs
explorationOutlierIDs <- escapeBehav %>%
  group_by(condition, phase, block) %>%
  identify_outliers(exploration) 

# output extreme outliers
#unique(explorationOutlierIDs$ID[explorationOutlierIDs$is.extreme==T]) #none
```
There were no extreme outliers with respect to exploration.

```{r exploration - escape behaviour test}
# Exploration by condition
exploration_nostress_group_descr <- summarySE(explorationNoStress, measurevar="exploration", groupvars="condition", conf.interval=.95) 

# Exploration by condition and block
exploration_block_descr <- summarySEwithin(explorationNoStress, measurevar="exploration", betweenvars="condition", withinvars="block", idvar="ID", conf.interval=.95) 

# rmANOVA with condition and block

# check normality assumption
explorationqqplot <- ggqqplot(explorationNoStress, "exploration", ggtheme = theme_bw()) +
  facet_grid(block ~ condition, labeller = "label_both") # crooked
#explorationqqplot

# run rmANOVA
exploration.fit <- aov_ez("ID","exploration", explorationNoStress, between="condition", within="block")
summary(exploration.fit)
nice(exploration.fit, es="pes")

# no group effect
# main effect of block --> more exploration in block 2

# confirm with robust ANOVA
exploration.fitrobust <- bwtrim(exploration ~ condition*factor(block), ID, data = explorationNoStress) 
exploration.fitrobust

# plot by group and block
explorationPlotBlock <- ggplot(explorationNoStress, aes(factor(block), exploration, fill=factor(condition))) +
  geom_violin() +  
  geom_boxplot(width=0.2, position=position_dodge(1)) +
  ylab("Exploration") +
  xlab("Block") +
  scale_fill_manual(values=c(colour1, colour2))  +
  laura_theme
explorationPlotBlock

# run rmANOVA including sex
explorationSex.fit <- aov_ez("ID","exploration", explorationNoStress, between=c("condition", "sex"), within="block")
summary(explorationSex.fit)
nice(explorationSex.fit, es="pes")

# interaction of sex x block --> in block 2, men explore more than women

# plot scores split for sex
exploration.fitSexPlot <- ggboxplot(
  explorationNoStress, x = "block", y = "exploration",
  color = "sex", palette = "cbPalette", short.panel.labs = FALSE)
exploration.fitSexPlot
```
There was no main effect of group but a significant difference in exploration between blocks. Participants showed increased exploration in block 2. In block 2, men explored more compared to women. 

## Escapes 
```{r escapes - escape behaviour test, plot to identify outliers}
# aggregate by ID, phase and block because sum_escapes was computed across trials
escapes <- aggregate(escapeBehav$sum_escapes, list(escapeBehav$ID, escapeBehav$phase, escapeBehav$block), max)
colnames(escapes) <- c("ID", "phase", "block", "sum_escapes_block")
escapes <- join(escapes, demo[, c(1:3)]) # add condition and sex

# escapes are most interesting for stress phase!
escapesStress <- escapes[escapes$phase!="NoStress", ]

# check for outliers by group
escapesOutlier <- ggplot(escapesStress, aes(condition, sum_escapes_block, fill=condition)) + 
    geom_violin() +
    geom_boxplot(width=0.2) +
    stat_sum_single(mean) +
    xlab("Experimental Condition") +
    ylab("Escapes") +
    scale_fill_manual(values=c(colour1, colour2)) +
    laura_theme
escapesOutlier # no outliers
```
There were no outliers with respect to escape rate.

```{r escapes - escape behaviour test }
# Escapes by condition
escapes_group_descr <- summarySE(escapesStress, measurevar="sum_escapes_block", groupvars="condition", conf.interval=.95) 

# Escapes by condition and block
escapes_block_descr <- summarySEwithin(escapesStress, measurevar="sum_escapes_block", betweenvars="condition", withinvars="block", conf.interval=.95) 

# plot by group and block
escapePlot <- ggplot(escapesStress, aes(factor(block), sum_escapes_block, fill=condition)) +
  geom_violin() +  
  geom_boxplot(width=0.2, position=position_dodge(1)) +
  ylab("Escapes") +
  xlab("Trial") +
  scale_fill_manual(values=c(colour1, colour2))  +
  ggtitle("Activity by Group over Blocks") +
  laura_theme
escapePlot

# rmANOVA with condition and block

# check normality assumption
escapeqqplot <- ggqqplot(escapesStress, "sum_escapes_block", ggtheme = theme_bw()) +
  facet_grid(block ~ condition, labeller = "label_both") # bit crooked
#escapeqqplot

# run rmANOVA
escapes.fit <- aov_ez("ID","sum_escapes_block", escapesStress, between="condition", within="block")
summary(escapes.fit)
nice(escapes.fit, es="pes")

# main effect of block 
# interaction of condition x block 

# post-hoc comparisons - condition and block
ref1 <- lsmeans(escapes.fit, specs = c("condition", "block"))
pwc <- contrast(ref1, method="pairwise", adjust="holm")
pwc

# EC improves from block 1 to 2, YC doesn't (escape rate even decreases slightly)

# confirm results with robust ANOVA
escapes.fitrobust <- bwtrim(sum_escapes_block ~ condition*factor(block), ID, data = escapesStress) 
escapes.fitrobust

# run rmANOVA including sex
escapesSex.fit <- aov_ez("ID","sum_escapes_block", escapesStress, between=c("condition", "sex"), within="block")
summary(escapesSex.fit)
nice(escapesSex.fit, es="pes")

# no sex effect but trend for an interaction of sex x block

# plot scores split for sex
escapes.fitSexPlot <- ggboxplot(
  escapesStress, x = "block", y = "sum_escapes_block",
  color = "sex", palette = "cbPalette", short.panel.labs = FALSE)
escapes.fitSexPlot

# men show increase in escapes, whereas women no change over blocks
```
EC managed to escape more often in block 2 compared to block 1, whereas YC did not improve (scores denote rather a slight decrease!). However, this interaction was not significant upon correction of family-wise error. Men improved more than women from block 1 to block 2. 

## Efficiency 
```{r efficiency - escape behaviour test, plot to identify outliers}
# aggregate by ID, phase and block because overall_efficiency was computed across trials
efficiency <- aggregate(escapeBehav$block_efficiency, list(escapeBehav$ID, escapeBehav$phase, escapeBehav$block), max)
colnames(efficiency) <- c("ID", "phase", "block", "overall_efficiency")
efficiency <- join(efficiency, demo[, c(1:3)]) # add condition and sex

# Efficiency is most interesting for stress phase!
efficiencyStress <- efficiency[efficiency$phase!="NoStress", ]

# check for outliers by group
efficiencyOutlier <- ggplot(efficiencyStress, aes(condition, overall_efficiency, fill=condition)) + 
    geom_violin() +
    geom_boxplot(width=0.2) +
    stat_sum_single(mean) +
    xlab("Experimental Condition") +
    ylab("Efficiency (escapes/activity)") +
    scale_fill_manual(values=c(colour1, colour2)) +
    laura_theme
efficiencyOutlier # some outliers

# get outlier IDs
efficiencyOutlierIDs <- efficiencyStress %>%
  group_by(condition) %>%
  identify_outliers(overall_efficiency) 

# output extreme outliers
#unique(efficiencyOutlierIDs$ID[efficiencyOutlierIDs$is.extreme==T]) #none
```
There no extreme outliers with respect to efficiency scores.

```{r efficiency - escape behaviour test}
# Efficiency by condition
efficiency_group_descr <- summarySE(efficiencyStress, measurevar="overall_efficiency", groupvars="condition", conf.interval=.95, na.rm=T) 

# Efficiency by condition and block
efficiency_block_descr <- summarySEwithin(efficiencyStress, measurevar="overall_efficiency", betweenvars="condition", withinvars="block", conf.interval=.95, na.rm=T) 

# rmANOVA with condition and block

# check normality assumption
efficiencyqqplot <- ggqqplot(efficiencyStress, "overall_efficiency", ggtheme = theme_bw()) +
  facet_grid(block ~ condition, labeller = "label_both") # crooked
#efficiencyqqplot

# run rmANOVA
efficiency.fit <- aov_ez("ID","overall_efficiency", efficiencyStress, between="condition", within="block")
summary(efficiency.fit)
nice(efficiency.fit, es="pes")

# interaction of condition x block 

# post-hoc comparisons - condition and block
ref1 <- lsmeans(efficiency.fit, specs = c("condition", "block"))
pwc <- contrast(ref1, method="pairwise", adjust="holm")
pwc

# YC shows less efficient behaviour (higher scores) from block 1 to 2, EC doesn't change (even shows slight improvement)
# in block 2, EC and YC differ significantly 

# confirm results with robust ANOVA
efficiency.fitrobust <- bwtrim(overall_efficiency ~ condition*factor(block), ID, data = efficiencyStress)
efficiency.fitrobust

# run rmANOVA including sex
efficiencySex.fit <- aov_ez("ID","overall_efficiency", efficiencyStress, between=c("condition", "sex"), within="block")
summary(efficiencySex.fit)
nice(efficiencySex.fit, es="pes")

# interaction of sex x block

# plot by sex and block
efficiency.fitSexPlot <- ggboxplot(
  efficiencyStress, x = "block", y = "overall_efficiency",
  color = "sex", palette = "cbPalette", short.panel.labs = FALSE)
efficiency.fitSexPlot

# men showed increased efficiency (lower scores) in block 2, women show no change (if not a decrease, i.e. slightly higher scores)
```
Whereas EC and YC did not differ in efficiency in block 1 (although YC had slightly better scores), YC showed sig. less efficient behaviour in block 2 compared to EC. There was also an interaction of sex x block.

# Correction for Multiple Dependent Variables

## Acute Stress Effects

```{r correcting for multiple dependent variables - acute stress effects}
# acute stress effect test family (helplessness, exhaustion, RT)

# get p-values from relevant tests
DVacute <- c("helplessness", "exhaustion", "RT")
p.orig <- c(.004685, .1077, .000000001659) # p-values in order of DVs - p-value of condition main effect is taken
correction_acute <- data.frame(DVacute, p.orig)
correction_acute <- correction_acute[order(correction_acute$p.orig),] #order by p-value

# calculate FWER-correction 
correction_acute$Bonferroni <- p.adjust(correction_acute$p.orig, method="bonferroni") # multiplies p-value by number of tests
correction_acute

# no changes in results, really
```

## Transfer Stress Effects
```{r correcting for multiple dependent variables - transfer stress effects}
# transfer stress effect test family (change in STADI, PANASneg, PANASpos, activity, exploration, escapes, efficiency) 

# get p-values from relevant tests
DVtransfer <- c("STADI", "PANASneg", "PANASpos", "exploration", "escapes", "efficiency")
p.orig <- c(.705393, .782582, .5822, .4048, .02611, .0006793) # p-values in order of DVs - p-value of condition x block effect is taken for exploration, escapes, efficiency; p-value of interaction effect condition x time is taken for STADI, PANASneg, PANASpos
correction_transfer <- data.frame(DVtransfer, p.orig)
correction_transfer <- correction_transfer[order(correction_transfer$p.orig),] #order by p-value

# calculate FWER-correction 
correction_transfer$Bonferroni <- p.adjust(correction_transfer$p.orig, method="bonferroni") # multiplies p-value by number of tests
correction_transfer

# group x block effect on escape rate becomes non-significant
```
```{r correcting for multiple dependent variables - across both acute and transfer stress effects}
# get p-values from relevant tests
DVall <- c("helplessness", "exhaustion", "RT", "STADI", "PANASneg", "PANASpos", "exploration", "escapes", "efficiency")
p.orig <- c(.004685, .1077, .000000001659, .705393, .782582, .5822, .4048, .02611, .000679) # p-values in order of DVs
correction_all <- data.frame(DVall, p.orig)
correction_all <- correction_all[order(correction_all$p.orig),] #order by p-value

# calculate FWER-orrection
correction_all$Bonferroni <- p.adjust(correction_all$p.orig, method="bonferroni")

# group x block effect on escape rate becomes non-significant
```

# Plots for Paper

## Figure 1
```{r Figure 1 - simple group comparisons}
# stressor aversiveness
fig1avers <- ggplot(ratingMean_avers, aes(x=condition, y=aversive_rating, colour=condition)) + 
  geom_point(size=5, position=position_dodge2(width=.5), alpha = 0.7) +
  stat_summary(fun.data=mean_se, fun.args = list(mult=1), 
                 geom="errorbar", color="black", width=.1, size=1) +
  stat_summary(fun.y=mean, geom="point", shape=21, fill="black", color="black", size=4, stroke=1) +
  scale_y_continuous(breaks=seq(1,7,1),limits=c(1,7.6)) +
  ylab("Stressor Aversiveness") +
  xlab("") +
  scale_colour_manual(values=c(colour1, colour2)) +
  geom_signif(comparisons = list(c("EC","YC")), y_position=7.4,
              tip_length=0, vjust=-.2, map_signif_level=T, size=0.8, textsize=6, colour="black") +
  laura_theme + theme(legend.position="none") 
fig1avers

# perceived control
fig1ctrl<- ggplot(ratingMean, aes(x=condition, y=control_rating, colour=condition)) + 
  geom_point(size=5, position=position_dodge2(width=.5), alpha = 0.7) +
  stat_summary(fun.data=mean_se, fun.args = list(mult=1), 
                 geom="errorbar", color="black", width=.1, size=1) +
  stat_summary(fun.y=mean, geom="point", shape=21, fill="black", color="black", size=4, stroke=1) +
  scale_y_continuous(breaks=seq(1,7,1), limits=c(1,7.4)) +
  ylab("Perceived Control") +
  xlab("") +
  scale_colour_manual(values=c(colour1, colour2)) +
  geom_signif(comparisons = list(c("EC","YC")), y_position=7.2,
              tip_length=0, vjust=.5, map_signif_level=T, size=0.8, textsize=8, colour="black") +
  laura_theme + theme(legend.position="none") 
fig1ctrl

# helplessness
fig1help <- ggplot(ratingMean, aes(x=condition, y=helpless_rating, colour=condition)) + 
  geom_point(size=5, position=position_dodge2(width=.5), alpha = 0.7) +
  stat_summary(fun.data=mean_se, fun.args = list(mult=2), 
                 geom="errorbar", color="black", width=.1, size=1) +
  stat_summary(fun.y=mean, geom="point", shape=21, fill="black", color="black", size=4, stroke=1) +
  scale_y_continuous(breaks=seq(1,7,1), limits=c(1,7.4)) +
  ylab("Helplessness") +
  xlab("") +
  scale_colour_manual(values=c(colour1, colour2)) +
  geom_signif(comparisons = list(c("EC","YC")), y_position=7.3,
              tip_length=0, vjust=.5, map_signif_level=T, size=0.8, textsize=8, colour="black") +
  laura_theme + theme(legend.position="none") 
fig1help

# exhaustion
fig1exhst <- ggplot(ratingMean, aes(x=condition, y=exhausted_rating, colour=condition)) + 
  geom_point(size=5, position=position_dodge2(width=.5), alpha = 0.7) +
  stat_summary(fun.data=mean_se, fun.args = list(mult=2), 
                 geom="errorbar", color="black", width=.1, size=1) +
  stat_summary(fun.y=mean, geom="point", shape=21, fill="black", color="black", size=4, stroke=1) +
  scale_y_continuous(breaks=seq(1,7,1), limits=c(1,7.6)) +
  labs(y="Exhaustion", x="") +
  scale_colour_manual(values=c(colour1, colour2)) +
  geom_signif(comparisons = list(c("EC","YC")), y_position=7.3,
              tip_length=0, vjust=-.2, map_signif_level=T, size=0.8, textsize=6, colour="black") +
  laura_theme + theme(legend.position="none") 
fig1exhst

# RT (t-test returns sig. but analysis with rmANOVA shows insig. post-hoc test)
fig1rt <- ggplot(RTMean, aes(x=condition, y=rt, colour=condition)) + 
  geom_point(size=5, position=position_dodge2(width=.5), alpha = 0.7) +
  stat_summary(fun.data=mean_se, fun.args = list(mult=2), 
                 geom="errorbar", color="black", width=.1, size=1) +
  stat_summary(fun.y=mean, geom="point", shape=21, fill="black", color="black", size=4, stroke=1) +
  scale_y_continuous(breaks=seq(200,1000,100), limits=c(275,1150)) +
  ylab("Reaction Time (ms)") +
  xlab("") +
  scale_colour_manual(values=c(colour1, colour2)) +
  geom_signif(comparisons = list(c("EC","YC")), y_position=1100,
              tip_length=0, vjust=.5, map_signif_level=T, size=0.8, textsize=8, colour="black") +
  laura_theme + theme(legend.position="none") 
fig1rt
```

## Figure 2
```{r Figure 2 - spaghetti plots}
# changes in affective state - spaghetti plots

# STADI
figSTADI <- ggplot(affStates, aes(x=time, y=STADI_S_Global)) +
  geom_point(data=affStates, aes(x=time, y=STADI_S_Global, group=ID, colour=condition)) +
  geom_line(data=affStates, aes(group=ID, colour=condition), size=1, alpha=.5) +
  geom_line(data=STADI_time_descr, stat="identity", aes(group=condition, x=time, y=STADI_S_Global), size=1, colour="black") +
  geom_errorbar(data=STADI_time_descr, aes(ymin=STADI_S_Global-se, ymax=STADI_S_Global+se), size=1, width =.2) +
  facet_wrap(~condition) +
  labs(y="Depression and Anxiety", x="") +
  scale_colour_manual(values=c(colour1, colour2)) +
  laura_theme + theme(legend.position="none") 
figSTADI

# PANASneg
figPANASneg <- ggplot(affStates_PANASneg, aes(x=time, y=PANAS_neg)) +
  geom_point(data=affStates_PANASneg, aes(x=time, y=PANAS_neg, group=ID, colour=condition)) +
  geom_line(data=affStates_PANASneg, aes(group=ID, colour=condition), size=1, alpha=.5) +
  geom_line(data=PANASneg_time_descr, stat="identity", aes(group=condition, x=time, y=PANAS_neg), size=1, colour="black") +
  geom_errorbar(data=PANASneg_time_descr, aes(ymin=PANAS_neg-se, ymax=PANAS_neg+se), size=1, width =.2) +
  facet_wrap(~condition) +
  labs(y="Negative Mood", x="") +
  scale_colour_manual(values=c(colour1, colour2)) +
  laura_theme + theme(legend.position="none") 
figPANASneg

# PANASpos
figPANASpos <- ggplot(affStates, aes(x=time, y=PANAS_pos)) +
  geom_point(data=affStates, aes(x=time, y=PANAS_pos, group=ID, colour=condition)) +
  geom_line(data=affStates, aes(group=ID, colour=condition), size=1, alpha=.5) +
  geom_line(data=PANASpos_time_descr, stat="identity", aes(group=condition, x=time, y=PANAS_pos), size=1, colour="black") +
  geom_errorbar(data=PANASpos_time_descr, aes(ymin=PANAS_pos-se, ymax=PANAS_pos+se), size=1, width =.2) +
  facet_wrap(~condition) +
  labs(y="Positive Mood", x="Time") +
  scale_colour_manual(values=c(colour1, colour2)) +
  laura_theme + theme(legend.position="none") 
figPANASpos
```

## Figure 3
```{r Figure 3 - escape behaviour test}
# efficiency - condition x block interaction effect
efficiencyStress$block_str <- ifelse(efficiencyStress$block=="1", "Block 1", "Block 2")
efficiencyStress$block_str <- as.factor(efficiencyStress$block_str)

fig2efficiency <- ggplot(data=efficiencyStress %>% 
                           group_by(condition, block_str), 
                         aes(x=as.factor(block_str), y = overall_efficiency, group = condition, 
                             color = condition, fill = condition)) + 
  geom_point(size = 5, position=position_dodge2(width=.5), alpha = 0.8) + 
  stat_summary(fun.data ="mean_se", fun.args = list(mult=1.96), geom="errorbar", size = 1, width = .2,
               position=position_dodge(.5), color="black") + # add error bars for se
  stat_summary(fun.y ="mean", geom="point", shape=21, fill="black", color="black", size=4, stroke=1,
               position=position_dodge2(.5)) + # add mean values
  scale_y_continuous(breaks=seq(0,300,50)) +
  ylab("Efficiency") +
  xlab("") +
  scale_colour_manual(values=c(colour1, colour2))  +
  annotate("rect", xmin=1.875, xmax=2.125, ymin=325, ymax=325, alpha=1, colour="black", size=0.8) + # add sig. line for EC 2 vs. YC 2
  annotate("rect", xmin=1.125, xmax=2.125, ymin=345, ymax=345, alpha=1, colour="black", size=0.8) + # add sig. line for YC 1 vs. YC 2
  annotate("text", x=1.6, y=350, label="**", cex=8) + # add sig. asterisks for YC 1 vs. YC 2
  annotate("text", x=2, y=327, label="**", cex=8) + # add sig. asterisks for EC2 vs. YC 2
  laura_theme + theme(legend.position="none")
fig2efficiency

# exploration - condition x block interaction effect
exploration_nostress_ID_block <- summarySE(explorationNoStress, measurevar="exploration", groupvars=c("ID", "block"), conf.interval=.95) 
exploration_nostress_ID_block <- join(exploration_nostress_ID_block, demo[, c(1,2)]) # add condition again
exploration_nostress_ID_block$block_str <- ifelse(exploration_nostress_ID_block$block=="1", "Block 1", "Block 2")
exploration_nostress_ID_block$block_str <- as.factor(exploration_nostress_ID_block$block_str)

fig2exploration <- ggplot(data=exploration_nostress_ID_block %>% 
                           group_by(condition, block_str), 
                         aes(x=as.factor(block_str), y = exploration, group = condition, 
                             color = condition, fill = condition)) + 
  geom_point(size = 5, position=position_dodge2(width=.5), alpha = 0.8) + 
  stat_summary(fun.data ="mean_se", fun.args = list(mult=1.96), geom="errorbar", size = 1, width = .2,
               position=position_dodge(.5), color="black") + # add error bars for se
  stat_summary(fun.y ="mean", geom="point", shape=21, fill="black", color="black", size=4, stroke=1,
               position=position_dodge2(.5)) + # add mean values
  scale_y_continuous(breaks=seq(0,550,50)) +
  ylab("Exploration") +
  xlab("") +
  scale_colour_manual(values=c(colour1, colour2))  +
  annotate("rect", xmin=1, xmax=2, ymin=445, ymax=445, alpha=1, colour="black", size=0.8) + # add sig. line for YC 1 vs. YC 2
  annotate("text", x=1.5, y=450, label="***", cex=8) + # add sig. asterisks for YC 1 vs. YC 2
  laura_theme + theme(legend.position="none")
fig2exploration

# escapes - condition x block interaction effect
escapesStress$block_str <- ifelse(escapesStress$block=="1", "Block 1", "Block 2")
escapesStress$block_str <- as.factor(escapesStress$block_str)

fig2escapes <- ggplot(data=escapesStress %>% 
                           group_by(condition, block_str), 
                         aes(x=as.factor(block_str), y = sum_escapes_block, group = condition, 
                             color = condition, fill = condition)) + 
  geom_point(size = 5, position=position_dodge2(width=.5), alpha = 0.8) + 
  stat_summary(fun.data ="mean_se", fun.args = list(mult=1.96), geom="errorbar", size = 1, width = .2,
               position=position_dodge(.5), color="black") + # add error bars for se
  stat_summary(fun.y ="mean", geom="point", shape=21, fill="black", color="black", size=4, stroke=1,
               position=position_dodge2(.5)) + # add mean values
  ylab("Escapes") +
  xlab("") +
  scale_colour_manual(values=c(colour1, colour2))  +
  laura_theme + theme(legend.position="none")
fig2escapes
```